<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera and Sensor Access</title>

    <!-- Подключаем A-Frame -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>

  </head>
  <body style="margin: 0">
    
    <!-- Кнопка для запуска камеры и датчиков -->
    <button id="startButton" onclick="startCameraAndSensors()" style="position: fixed; top: 10px; left: 10px; z-index: 1000;">Start AR Mode</button>
    
    <!-- Кнопка для остановки камеры и датчиков -->
    <button id="stopButton" onclick="stopCameraAndSensors()" style="position: fixed; top: 50px; left: 10px; z-index: 1000; display: none;">Exit AR Mode</button>

    <!-- Сцена A-Frame -->
    <a-scene>
      <a-entity camera></a-entity>
    </a-scene>
    
    <!-- Канвас для отображения камеры -->
    <video id="videoFeed" autoplay style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; display: none;"></video>

    <script>
      let videoStream;
      let sensors = {
        accelerometer: null,
        gyroscope: null,
      };

      function startCameraAndSensors() {
        // Включаем отображение видео
        const video = document.getElementById('videoFeed');
        video.style.display = 'block';

        // Скрываем кнопку старта и показываем кнопку остановки
        document.getElementById('startButton').style.display = 'none';
        document.getElementById('stopButton').style.display = 'block';

        // Запрашиваем доступ к камере
        navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
          .then(stream => {
            video.srcObject = stream;
            videoStream = stream;
          })
          .catch(error => {
            console.error("Ошибка доступа к камере:", error);
          });

        // Подключаем акселерометр и гироскоп
        if (window.DeviceMotionEvent) {
          sensors.accelerometer = new Accelerometer({ frequency: 60 });
          sensors.accelerometer.addEventListener('reading', () => {
            console.log(`Accelerometer: x=${sensors.accelerometer.x}, y=${sensors.accelerometer.y}, z=${sensors.accelerometer.z}`);
          });
          sensors.accelerometer.start();
        } else {
          console.warn("Акселерометр не поддерживается на этом устройстве.");
        }

        if (window.DeviceOrientationEvent) {
          sensors.gyroscope = new Gyroscope({ frequency: 60 });
          sensors.gyroscope.addEventListener('reading', () => {
            console.log(`Gyroscope: x=${sensors.gyroscope.x}, y=${sensors.gyroscope.y}, z=${sensors.gyroscope.z}`);
          });
          sensors.gyroscope.start();
        } else {
          console.warn("Гироскоп не поддерживается на этом устройстве.");
        }
      }

      function stopCameraAndSensors() {
        // Останавливаем видео
        if (videoStream) {
          videoStream.getTracks().forEach(track => track.stop());
          videoStream = null;
        }

        // Скрываем видео и переключаем видимость кнопок
        document.getElementById('videoFeed').style.display = 'none';
        document.getElementById('startButton').style.display = 'block';
        document.getElementById('stopButton').style.display = 'none';

        // Отключаем датчики
        if (sensors.accelerometer) sensors.accelerometer.stop();
        if (sensors.gyroscope) sensors.gyroscope.stop();
      }
    </script>
  </body>
</html>
