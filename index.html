<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AR with Accelerometer and Gyroscope</title>
</head>
<body style="margin: 0;">

  <!-- Кнопки управления -->
  <button onclick="startAR()" style="position: fixed; top: 10px; left: 10px; z-index: 1000;">Включить камеру и сенсоры</button>
  <button onclick="stopAR()" style="position: fixed; top: 10px; left: 150px; z-index: 1000;">Выключить</button>

  <!-- Меню с данными сенсоров -->
  <div id="sensorData" style="position: fixed; top: 50px; left: 10px; background: rgba(0, 0, 0, 0.5); color: white; padding: 10px; display: none; z-index: 1000;">
    <p>Accelerometer:</p>
    <p id="acceleration">x: 0, y: 0, z: 0</p>
    <p>Gyroscope:</p>
    <p id="rotation">x: 0, y: 0, z: 0</p>
  </div>

  <script>
    let videoStream;

    function startAR() {
      // Включаем доступ к камере
      navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
        .then(stream => {
          videoStream = stream;
          const video = document.createElement('video');
          video.srcObject = stream;
          video.play();
          document.body.appendChild(video);
          video.style.position = 'absolute';
          video.style.top = '0';
          video.style.left = '0';
          video.style.width = '100%';
          video.style.height = '100%';
          video.style.zIndex = '-1';

          document.getElementById('sensorData').style.display = 'block';

          if (window.DeviceMotionEvent) {
            window.addEventListener('devicemotion', handleMotion);
          } else {
            alert("Ваше устройство не поддерживает акселерометр");
          }

          if (window.DeviceOrientationEvent) {
            window.addEventListener('deviceorientation', handleOrientation);
          } else {
            alert("Ваше устройство не поддерживает гироскоп");
          }
        })
        .catch(error => {
          console.error("Ошибка доступа к камере:", error);
        });
    }

    function handleMotion(event) {
      const x = event.acceleration.x.toFixed(2);
      const y = event.acceleration.y.toFixed(2);
      const z = event.acceleration.z.toFixed(2);
      document.getElementById('acceleration').innerText = `x: ${x}, y: ${y}, z: ${z}`;
    }

    function handleOrientation(event) {
      const alpha = event.alpha.toFixed(2); // Угол вокруг оси z
      const beta = event.beta.toFixed(2);   // Угол вокруг оси x
      const gamma = event.gamma.toFixed(2); // Угол вокруг оси y
      document.getElementById('rotation').innerText = `x: ${beta}, y: ${gamma}, z: ${alpha}`;
    }

    // Отключаем камеру и сенсоры
    function stopAR() {
      if (videoStream) {
        const tracks = videoStream.getTracks();
        tracks.forEach(track => track.stop());
        videoStream = null;
      }

      const video = document.querySelector('video');
      if (video) {
        document.body.removeChild(video);
      }

      document.getElementById('sensorData').style.display = 'none';
      window.removeEventListener('devicemotion', handleMotion);
      window.removeEventListener('deviceorientation', handleOrientation);
    }
  </script>
</body>
</html>
